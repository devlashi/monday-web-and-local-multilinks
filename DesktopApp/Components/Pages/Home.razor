@page "/"
@inject LocalApiService ApiService
@implements IDisposable


@if (passcode == null)
{
    <p>Initializing ...</p>
}
else
{
    
    <p class="text-success">Listening to the app in monday.com ...</p>
    <p>
        Access token copied to clipboard. You can paste it in the monday app if needed.
        This application must keep running in order to open files or folders through the monday app.
        You can minimize this and continue working in monday.
    </p> 
}

@foreach (var log in Logs)
{
    <div class=@(log.IsWarning ? "text-danger" : "")>@log.Message</div>
}

<div id="loader" class="loader"></div>

@code {
    private string? passcode;
    private IReadOnlyList<LogText> Logs => LogsService.Logs;

    protected override void OnInitialized()
    {
        passcode = ApiService.Code;
        LogsService.OnLogAdded += UpdateLogs;
    }

    private void UpdateLogs()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        LogsService.OnLogAdded -= UpdateLogs; // prevent memory leak
    }

}

