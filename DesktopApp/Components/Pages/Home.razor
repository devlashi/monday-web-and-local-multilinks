@page "/"
@inject LocalApiService ApiService
@inject NavigationManager NM
@implements IDisposable


@if (passcode == null)
{
    <p>Initializing ...</p>
}
else
{

    <p class="text-info">Listening for activity on <img height="30" src="/img/monday.png" /></p>
    <p>
        Access token copied to clipboard. You can paste it in the monday app if needed.
        This application must keep running in order to open files or folders through the monday app.
        You can minimize this and continue working in monday.
    </p> 
}

@foreach (var log in Logs)
{
    <div class=@(log.IsWarning ? "text-danger" : "")>@log.Message</div>
}

<div class="d-flex justify-content-center position-relative mt-4 mb-5">
    <div id="loader" class="loader"></div>
</div>

@code {
    private string? passcode;
    private IReadOnlyList<LogText> Logs => LogsService.Logs;

    protected override void OnInitialized()
    {
        passcode = ApiService.Code;
        LogsService.OnLogAdded += UpdateLogs;
    }

    private void UpdateLogs()
    {
        InvokeAsync(StateHasChanged);
        NM.NavigateTo("/#loader");
    }

    public void Dispose()
    {
        LogsService.OnLogAdded -= UpdateLogs; // prevent memory leak
    }

}

